<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acquisition Funnel Dashboard | ASSA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary-web3: #8a2be2;
            --secondary-esports: #00ff88;
            --accent-danger: #ff4466;
            --accent-warning: #ffaa00;
            --accent-success: #00ff88;
            --accent-info: #2b9be2;
            --funnel-bg: #0f0f1a;
            --card-bg: #1a1a2e;
            --card-border: #2d2d4a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0;
            --text-muted: #6a6a8a;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.4);
            --step-1: #8a2be2;
            --step-2: #6a3dc9;
            --step-3: #4a4fb0;
            --step-4: #2a6197;
            --step-5: #0a737e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Inter', -apple-system, sans-serif;
        }
        
        body {
            background-color: var(--funnel-bg);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(138, 43, 226, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(10, 115, 126, 0.1) 0%, transparent 20%);
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* GLOBAL NAVIGATION BAR */
        .global-navigation {
            background-color: rgba(10, 10, 21, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 0;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        .nav-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            height: 60px;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: 40px;
        }
        
        .nav-logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary-web3), var(--secondary-esports));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }
        
        .nav-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 2px;
            flex: 1;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background-color: rgba(138, 43, 226, 0.1);
            color: var(--primary-web3);
        }
        
        .nav-item.active {
            background-color: rgba(138, 43, 226, 0.2);
            color: var(--primary-web3);
            font-weight: 600;
        }
        
        .nav-item i {
            font-size: 16px;
        }
        
        .nav-divider {
            width: 1px;
            height: 24px;
            background-color: var(--card-border);
            margin: 0 16px;
        }
        
        .nav-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: inherit;
        }
        
        .user-profile:hover {
            background-color: rgba(138, 43, 226, 0.1);
            text-decoration: none;
            color: inherit;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(138, 43, 226, 0.3);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .nav-notification {
            position: relative;
            background: none;
            border: none;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }
        
        .nav-notification:hover {
            background-color: rgba(138, 43, 226, 0.1);
            color: var(--primary-web3);
        }
        
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: var(--accent-danger);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* NOTIFICATION PANEL */
        .notification-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-hover);
            width: 350px;
            z-index: 999;
            display: none;
            overflow: hidden;
        }
        
        .notification-header {
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification-title {
            font-size: 16px;
            font-weight: 700;
        }
        
        .notification-clear {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
        }
        
        .notification-clear:hover {
            color: var(--primary-web3);
        }
        
        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .notification-item:hover {
            background-color: rgba(138, 43, 226, 0.05);
        }
        
        .notification-item.unread {
            background-color: rgba(138, 43, 226, 0.1);
        }
        
        .notification-message {
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .notification-time {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* HEADER */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--card-border);
            margin-top: 80px; /* Compensate for fixed nav */
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: linear-gradient(135deg, var(--step-1), var(--step-5));
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.4);
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(to right, var(--text-primary), var(--step-3));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: -0.5px;
        }
        
        .logo-text p {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .funnel-badge {
            background-color: rgba(10, 115, 126, 0.2);
            color: var(--step-5);
            font-size: 10px;
            padding: 3px 10px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        /* SEGMENT FILTERS */
        .segment-filters {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .segment-group {
            display: flex;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 4px;
            border: 1px solid var(--card-border);
        }
        
        .segment-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .segment-btn.active {
            background-color: rgba(138, 43, 226, 0.2);
            color: var(--primary-web3);
            font-weight: 600;
        }
        
        .date-range {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 14px;
            background-color: var(--card-bg);
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
        }
        
        /* FUNNEL OVERVIEW */
        .funnel-overview {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--primary-web3);
        }
        
        .section-controls {
            display: flex;
            gap: 12px;
        }
        
        .control-btn {
            background-color: rgba(30, 30, 58, 0.5);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background-color: rgba(138, 43, 226, 0.1);
            color: var(--primary-web3);
        }
        
        /* FUNNEL VISUALIZATION */
        .funnel-visualization {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 400px;
            position: relative;
            margin: 40px 0;
            padding: 0 40px;
        }
        
        .funnel-step {
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }
        
        .step-connector {
            position: absolute;
            top: 50%;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--step-1), var(--step-5));
            z-index: 1;
            transform: translateY(-50%);
        }
        
        .step-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
            border: 4px solid;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .step-circle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.4);
        }
        
        .step-1 .step-circle {
            background-color: rgba(138, 43, 226, 0.2);
            border-color: var(--step-1);
            color: var(--step-1);
        }
        
        .step-2 .step-circle {
            background-color: rgba(106, 61, 201, 0.2);
            border-color: var(--step-2);
            color: var(--step-2);
        }
        
        .step-3 .step-circle {
            background-color: rgba(74, 79, 176, 0.2);
            border-color: var(--step-3);
            color: var(--step-3);
        }
        
        .step-4 .step-circle {
            background-color: rgba(42, 97, 151, 0.2);
            border-color: var(--step-4);
            color: var(--step-4);
        }
        
        .step-5 .step-circle {
            background-color: rgba(10, 115, 126, 0.2);
            border-color: var(--step-5);
            color: var(--step-5);
        }
        
        .step-info {
            text-align: center;
            margin-top: 15px;
        }
        
        .step-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .step-value {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        
        .step-conversion {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .conversion-up {
            color: var(--accent-success);
        }
        
        .conversion-down {
            color: var(--accent-danger);
        }
        
        /* FUNNEL METRICS */
        .funnel-metrics {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 40px;
        }
        
        @media (max-width: 1400px) {
            .funnel-metrics {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .funnel-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .funnel-metrics {
                grid-template-columns: 1fr;
            }
        }
        
        .funnel-metric {
            background-color: rgba(30, 30, 58, 0.5);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--card-border);
            transition: all 0.3s;
        }
        
        .funnel-metric:hover {
            transform: translateY(-4px);
            border-color: var(--primary-web3);
        }
        
        .metric-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 6px;
        }
        
        .metric-detail {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        /* DROP-OFF HEATMAP */
        .dropoff-heatmap {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow);
        }
        
        .heatmap-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        .heatmap {
            display: table;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        .heatmap-row {
            display: table-row;
        }
        
        .heatmap-cell {
            display: table-cell;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--card-border);
            transition: all 0.3s;
            cursor: pointer;
            min-width: 120px;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
            z-index: 10;
            position: relative;
        }
        
        .heatmap-header {
            background-color: rgba(30, 30, 58, 0.8);
            font-weight: 700;
            font-size: 15px;
        }
        
        .heatmap-source {
            text-align: left;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .source-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .twitch-icon {
            background-color: rgba(100, 65, 164, 0.2);
            color: #9146ff;
        }
        
        .twitter-icon {
            background-color: rgba(29, 161, 242, 0.2);
            color: #1da1f2;
        }
        
        .opensea-icon {
            background-color: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
        }
        
        .discord-icon {
            background-color: rgba(88, 101, 242, 0.2);
            color: #5865f2;
        }
        
        .youtube-icon {
            background-color: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }
        
        .heatmap-value {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        
        .heatmap-change {
            font-size: 12px;
        }
        
        /* SEGMENT FUNNELS */
        .segment-funnels {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow);
        }
        
        .segment-chart-container {
            height: 400px;
            margin-top: 20px;
        }
        
        /* A/B TEST RESULTS */
        .abtest-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .abtest-results {
                grid-template-columns: 1fr;
            }
        }
        
        .abtest-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow);
        }
        
        .abtest-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .abtest-variant {
            background-color: rgba(30, 30, 58, 0.5);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--card-border);
            transition: all 0.3s;
        }
        
        .abtest-variant.winner {
            border-color: var(--accent-success);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }
        
        .variant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .variant-name {
            font-size: 16px;
            font-weight: 700;
        }
        
        .variant-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .status-winner {
            background-color: rgba(0, 255, 136, 0.1);
            color: var(--accent-success);
        }
        
        .status-loser {
            background-color: rgba(255, 68, 102, 0.1);
            color: var(--accent-danger);
        }
        
        .variant-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .variant-metric {
            text-align: center;
        }
        
        .variant-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .variant-value {
            font-size: 18px;
            font-weight: 800;
        }
        
        /* OPTIMIZATION RECOMMENDATIONS */
        .optimization-recommendations {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow);
        }
        
        .rec-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 1200px) {
            .rec-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .rec-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .rec-card {
            background-color: rgba(30, 30, 58, 0.5);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--card-border);
            transition: all 0.3s;
        }
        
        .rec-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-web3);
        }
        
        .rec-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .rec-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .rec-icon.technical {
            background-color: rgba(138, 43, 226, 0.1);
            color: var(--primary-web3);
        }
        
        .rec-icon.ux {
            background-color: rgba(0, 255, 136, 0.1);
            color: var(--accent-success);
        }
        
        .rec-icon.messaging {
            background-color: rgba(255, 170, 0, 0.1);
            color: var(--accent-warning);
        }
        
        .rec-title {
            font-size: 16px;
            font-weight: 700;
        }
        
        .rec-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .rec-impact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .impact-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .impact-value {
            font-size: 18px;
            font-weight: 800;
        }
        
        /* FOOTER */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--card-border);
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
        }
        
        .dashboard-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .dashboard-link {
            background-color: var(--card-bg);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .dashboard-link:hover {
            background-color: rgba(138, 43, 226, 0.1);
            color: var(--primary-web3);
            border-color: var(--primary-web3);
        }
        
        .dashboard-link.active {
            background-color: rgba(138, 43, 226, 0.2);
            color: var(--primary-web3);
            border-color: var(--primary-web3);
        }
        
        /* RESPONSIVE */
        @media (max-width: 992px) {
            .nav-menu span {
                display: none;
            }
            
            .nav-item {
                padding: 12px;
            }
            
            .nav-title {
                display: none;
            }
            
            .user-info {
                display: none;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }
            
            .segment-filters {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 768px) {
            .segment-group {
                flex-wrap: wrap;
            }
            
            .segment-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .date-range {
                padding: 8px 12px;
            }
            
            .funnel-visualization {
                padding: 0 10px;
            }
            
            .step-circle {
                width: 60px;
                height: 60px;
                font-size: 18px;
            }
        }
        
        @media (max-width: 576px) {
            .notification-panel {
                width: calc(100% - 40px);
                right: 10px;
            }
            
            .segment-btn span {
                display: none;
            }
            
            .segment-btn i {
                margin-right: 0;
            }
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <!-- GLOBAL NAVIGATION BAR -->
    <nav class="global-navigation">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="nav-logo">
                    <i class="fas fa-cube"></i>
                </div>
                <span class="nav-title">Marketing Dashboard Suite</span>
            </div>
            
            <div class="nav-menu">
                <a href="index.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Overview</span>
                </a>
                <a href="dashboard01.html" class="nav-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Performance</span>
                </a>
                <a href="dashboard02.html" class="nav-item">
                    <i class="fas fa-sitemap"></i>
                    <span>Attribution</span>
                </a>
                <a href="dashboard03.html" class="nav-item active">
                    <i class="fas fa-filter"></i>
                    <span>Funnel</span>
                </a>
                <div class="nav-divider"></div>
                <a href="dashboard1.html" class="nav-item">
                    <i class="fas fa-command"></i>
                    <span>Command Center</span>
                </a>
            </div>
            
            <div class="nav-actions">
                <button class="nav-notification" id="notification-btn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                <a href="https://h13digital.github.io/#portfolio" class="user-profile" id="user-profile-link">
                    <div class="user-avatar">
                        <img src="https://avatars.githubusercontent.com/u/247514700" alt="HIEP NGUYEN" onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%238a2be2%22/><text x=%2250%22 y=%2260%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2240%22>H</text></svg>'">
                    </div>
                    <div class="user-info">
                        <span class="user-name">HIEP NGUYEN</span>
                        <span class="user-role">Marketing Architect</span>
                    </div>
                </a>
            </div>
        </div>
    </nav>

    <!-- NOTIFICATION PANEL -->
    <div class="notification-panel" id="notification-panel">
        <div class="notification-header">
            <div class="notification-title">Notifications</div>
            <button class="notification-clear" id="clear-notifications">Clear All</button>
        </div>
        <div class="notification-list" id="notification-list">
            <div class="notification-item unread">
                <div class="notification-message">
                    <strong>Wallet connection</strong> drop-off increased by 8% today
                </div>
                <div class="notification-time">25 minutes ago</div>
            </div>
            <div class="notification-item unread">
                <div class="notification-message">
                    <strong>A/B Test #3</strong> reached statistical significance
                </div>
                <div class="notification-time">1 hour ago</div>
            </div>
            <div class="notification-item">
                <div class="notification-message">
                    <strong>New bottleneck</strong> detected at Step 3 (Wallet Connect)
                </div>
                <div class="notification-time">3 hours ago</div>
            </div>
            <div class="notification-item">
                <div class="notification-message">
                    Weekly funnel analysis report is ready
                </div>
                <div class="notification-time">Yesterday</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">F</div>
                <div class="logo-text">
                    <h1>Acquisition Funnel Dashboard</h1>
                    <p>Daily Conversion Optimization <span class="funnel-badge">REAL-TIME</span></p>
                </div>
            </div>
            
            <div class="segment-filters">
                <div class="segment-group">
                    <button class="segment-btn active" onclick="changeSegment('all')">
                        <i class="fas fa-users"></i>
                        All Users
                    </button>
                    <button class="segment-btn" onclick="changeSegment('players')">
                        <i class="fas fa-gamepad"></i>
                        Players
                    </button>
                    <button class="segment-btn" onclick="changeSegment('traders')">
                        <i class="fas fa-chart-line"></i>
                        Traders
                    </button>
                    <button class="segment-btn" onclick="changeSegment('collectors')">
                        <i class="fas fa-gem"></i>
                        Collectors
                    </button>
                </div>
                <div class="date-range">
                    <i class="far fa-calendar"></i>
                    <span id="current-date">23/04/2025</span>
                </div>
            </div>
        </div>
        
        <!-- FUNNEL OVERVIEW -->
        <div class="funnel-overview">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-filter"></i>
                    Acquisition Funnel Overview
                </div>
                <div class="section-controls">
                    <button class="control-btn" onclick="exportFunnelData()">
                        <i class="fas fa-download"></i>
                        Export Data
                    </button>
                    <button class="control-btn" onclick="refreshFunnelData()">
                        <i class="fas fa-sync"></i>
                        Refresh
                    </button>
                </div>
            </div>
            
            <!-- FUNNEL VISUALIZATION -->
            <div class="funnel-visualization">
                <div class="step-connector"></div>
                
                <!-- Step 1: Impressions -->
                <div class="funnel-step step-1" onclick="showStepDetails(1)">
                    <div class="step-circle">1</div>
                    <div class="step-info">
                        <div class="step-name">Impressions</div>
                        <div class="step-value" id="step-1-value">245.2K</div>
                        <div class="step-conversion">
                            <i class="fas fa-arrow-up conversion-up"></i>
                            <span class="conversion-up">+12% WoW</span>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: Landing Page -->
                <div class="funnel-step step-2" onclick="showStepDetails(2)">
                    <div class="step-circle">2</div>
                    <div class="step-info">
                        <div class="step-name">Landing Page</div>
                        <div class="step-value" id="step-2-value">45.8K</div>
                        <div class="step-conversion">
                            <span>18.7% CTR</span>
                        </div>
                    </div>
                </div>
                
                <!-- Step 3: Wallet Connect -->
                <div class="funnel-step step-3" onclick="showStepDetails(3)">
                    <div class="step-circle">3</div>
                    <div class="step-info">
                        <div class="step-name">Wallet Connect</div>
                        <div class="step-value" id="step-3-value">12.4K</div>
                        <div class="step-conversion">
                            <i class="fas fa-arrow-up conversion-up"></i>
                            <span class="conversion-up">27.1% Rate</span>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: First TX -->
                <div class="funnel-step step-4" onclick="showStepDetails(4)">
                    <div class="step-circle">4</div>
                    <div class="step-info">
                        <div class="step-name">First TX</div>
                        <div class="step-value" id="step-4-value">3.2K</div>
                        <div class="step-conversion">
                            <span>25.8% Rate</span>
                        </div>
                    </div>
                </div>
                
                <!-- Step 5: Activated Wallet -->
                <div class="funnel-step step-5" onclick="showStepDetails(5)">
                    <div class="step-circle">5</div>
                    <div class="step-info">
                        <div class="step-name">Activated Wallet</div>
                        <div class="step-value" id="step-5-value">1.8K</div>
                        <div class="step-conversion">
                            <i class="fas fa-arrow-up conversion-up"></i>
                            <span class="conversion-up">56.3% Rate</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- FUNNEL METRICS -->
            <div class="funnel-metrics">
                <div class="funnel-metric">
                    <div class="metric-label">
                        <i class="fas fa-bolt"></i>
                        Overall Conversion Rate
                    </div>
                    <div class="metric-value">0.73%</div>
                    <div class="metric-detail">From impression to activation</div>
                </div>
                
                <div class="funnel-metric">
                    <div class="metric-label">
                        <i class="fas fa-clock"></i>
                        Time-to-First-TX
                    </div>
                    <div class="metric-value">3:12</div>
                    <div class="metric-detail">Avg: 3:12 | Med: 2:48 | 90th: 5:36</div>
                </div>
                
                <div class="funnel-metric">
                    <div class="metric-label">
                        <i class="fas fa-wallet"></i>
                        Cost Per Activated Wallet
                    </div>
                    <div class="metric-value">$1.24</div>
                    <div class="metric-detail">Target: < $1.50 | Status: On Track</div>
                </div>
                
                <div class="funnel-metric">
                    <div class="metric-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Funnel Velocity
                    </div>
                    <div class="metric-value">2.4 days</div>
                    <div class="metric-detail">From impression to activation</div>
                </div>
                
                <div class="funnel-metric">
                    <div class="metric-label">
                        <i class="fas fa-chart-line"></i>
                        WoW Improvement
                    </div>
                    <div class="metric-value">+8%</div>
                    <div class="metric-detail">Overall conversion rate improvement</div>
                </div>
            </div>
        </div>
        
        <!-- DROP-OFF HEATMAP -->
        <div class="dropoff-heatmap">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-fire"></i>
                    Drop-off Heatmap by Traffic Source
                </div>
                <div class="section-controls">
                    <button class="control-btn" onclick="toggleHeatmapView()">
                        <i class="fas fa-exchange-alt"></i>
                        Switch View
                    </button>
                </div>
            </div>
            
            <div class="heatmap-container">
                <div class="heatmap" id="heatmap">
                    <!-- Heatmap will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- SEGMENT FUNNELS -->
        <div class="segment-funnels">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Funnel Performance by User Segment
                </div>
                <div class="section-controls">
                    <button class="control-btn" onclick="toggleSegmentChart()">
                        <i class="fas fa-eye"></i>
                        Toggle Segments
                    </button>
                </div>
            </div>
            
            <div class="segment-chart-container">
                <canvas id="segmentChart"></canvas>
            </div>
        </div>
        
        <div class="abtest-results">
            <!-- A/B TEST RESULTS -->
            <div class="abtest-card">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-flask"></i>
                        A/B Test Results
                    </div>
                    <div class="section-controls">
                        <button class="control-btn" onclick="viewAllTests()">
                            <i class="fas fa-list"></i>
                            View All
                        </button>
                    </div>
                </div>
                
                <div class="abtest-grid">
                    <div class="abtest-variant winner">
                        <div class="variant-header">
                            <div class="variant-name">Variant A (Control)</div>
                            <div class="variant-status status-winner">WINNER</div>
                        </div>
                        <div class="variant-metrics">
                            <div class="variant-metric">
                                <div class="variant-label">Conversion Rate</div>
                                <div class="variant-value">27.1%</div>
                            </div>
                            <div class="variant-metric">
                                <div class="variant-label">Time-to-TX</div>
                                <div class="variant-value">3:12</div>
                            </div>
                            <div class="variant-metric">
                                <div class="variant-label">Sample Size</div>
                                <div class="variant-value">12.4K</div>
                            </div>
                            <div class="variant-metric">
                                <div class="variant-label">Confidence</div>
                                <div class="variant-value">99.2%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="abtest-variant">
                        <div class="variant-header">
                            <div class="variant-name">Variant B (New)</div>
                            <div class="variant-status status-loser">-8.4%</div>
                        </div>
                        <div class="variant-metrics">
                            <div class="variant-metric">
                                <div class="variant-label">Conversion Rate</div>
                                <div class="variant-value">24.8%</div>
                            </div>
                            <div class="variant-metric">
                                <div class="variant-label">Time-to-TX</div>
                                <div class="variant-value">3:45</div>
                            </div>
                            <div class="variant-metric">
                                <div class="variant-label">Sample Size</div>
                                <div class="variant-value">11.8K</div>
                            </div>
                            <div class="variant-metric">
                                <div class="variant-label">Confidence</div>
                                <div class="variant-value">98.7%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="funnel-metric" style="margin-top: 20px;">
                    <div class="metric-label">
                        <i class="fas fa-lightbulb"></i>
                        Test Conclusion
                    </div>
                    <div class="metric-value">Keep Current Design</div>
                    <div class="metric-detail">Variant B decreased conversion by 8.4% with statistical significance (p < 0.01)</div>
                </div>
            </div>
            
            <!-- BOTTLENECK ANALYSIS -->
            <div class="abtest-card">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Bottleneck Analysis
                    </div>
                    <div class="section-controls">
                        <button class="control-btn" onclick="runBottleneckAnalysis()">
                            <i class="fas fa-search"></i>
                            Analyze
                        </button>
                    </div>
                </div>
                
                <div class="funnel-metrics" style="margin-top: 20px;">
                    <div class="funnel-metric">
                        <div class="metric-label">
                            <i class="fas fa-exclamation-triangle"></i>
                            #1 Bottleneck
                        </div>
                        <div class="metric-value">Step 2 → 3</div>
                        <div class="metric-detail">Landing Page → Wallet Connect (72.9% drop-off)</div>
                    </div>
                    
                    <div class="funnel-metric">
                        <div class="metric-label">
                            <i class="fas fa-exclamation-circle"></i>
                            #2 Bottleneck
                        </div>
                        <div class="metric-value">Step 3 → 4</div>
                        <div class="metric-detail">Wallet Connect → First TX (74.2% drop-off)</div>
                    </div>
                    
                    <div class="funnel-metric">
                        <div class="metric-label">
                            <i class="fas fa-clock"></i>
                            Avg. Time at Bottleneck
                        </div>
                        <div class="metric-value">1:48</div>
                        <div class="metric-detail">Users spend most time deciding at Step 3</div>
                    </div>
                    
                    <div class="funnel-metric">
                        <div class="metric-label">
                            <i class="fas fa-dollar-sign"></i>
                            Revenue Impact
                        </div>
                        <div class="metric-value">$42K/month</div>
                        <div class="metric-detail">Potential revenue if bottleneck fixed</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- OPTIMIZATION RECOMMENDATIONS -->
        <div class="optimization-recommendations">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    Optimization Recommendations
                </div>
                <div class="section-controls">
                    <button class="control-btn" onclick="prioritizeRecommendations()">
                        <i class="fas fa-sort-amount-down"></i>
                        Prioritize
                    </button>
                </div>
            </div>
            
            <div class="rec-grid">
                <div class="rec-card">
                    <div class="rec-header">
                        <div class="rec-icon technical">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="rec-title">Fix Wallet Connection</div>
                    </div>
                    <div class="rec-desc">
                        32% of users experience wallet connection errors. Implement auto-retry and better error messages.
                    </div>
                    <div class="rec-impact">
                        <div class="impact-label">Expected Impact</div>
                        <div class="impact-value" style="color: var(--accent-success);">+15% Conversion</div>
                    </div>
                </div>
                
                <div class="rec-card">
                    <div class="rec-header">
                        <div class="rec-icon ux">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="rec-title">Simplify First TX</div>
                    </div>
                    <div class="rec-desc">
                        First transaction is too complex. Create guided tutorial and pre-populate gas fees.
                    </div>
                    <div class="rec-impact">
                        <div class="impact-label">Expected Impact</div>
                        <div class="impact-value" style="color: var(--accent-success);">+12% Conversion</div>
                    </div>
                </div>
                
                <div class="rec-card">
                    <div class="rec-header">
                        <div class="rec-icon messaging">
                            <i class="fas fa-comment-alt"></i>
                        </div>
                        <div class="rec-title">Improve Value Proposition</div>
                    </div>
                    <div class="rec-desc">
                        Landing page doesn't clearly communicate Web3 benefits. A/B test new messaging.
                    </div>
                    <div class="rec-impact">
                        <div class="impact-label">Expected Impact</div>
                        <div class="impact-value" style="color: var(--accent-success);">+8% CTR</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- FOOTER -->
        <div class="footer">
            <div class="last-updated">
                Funnel data cập nhật lần cuối: <span style="color: var(--secondary-esports);">23/04/2025 15:45</span>
                <br>
                <span style="font-size: 12px;">Đang theo dõi <span id="live-users" class="pulse">1,842</span> users trong funnel</span>
            </div>
            <div class="dashboard-links">
                <a href="dashboard01.html" class="dashboard-link">Performance</a>
                <a href="dashboard02.html" class="dashboard-link">Attribution</a>
                <a href="#" class="dashboard-link active">Acquisition Funnel</a>
                <a href="dashboard1.html" class="dashboard-link">Command Center</a>
            </div>
        </div>
    </div>

    <script>
        // NAVIGATION BAR FUNCTIONALITY
        const notificationBtn = document.getElementById('notification-btn');
        const notificationPanel = document.getElementById('notification-panel');
        const clearNotificationsBtn = document.getElementById('clear-notifications');
        const notificationList = document.getElementById('notification-list');
        const userProfileLink = document.getElementById('user-profile-link');
        
        // Thêm sự kiện click để redirect về portfolio
        userProfileLink.addEventListener('click', function(e) {
            // Đảm bảo mở trong cùng cửa sổ (không mở tab mới)
            e.preventDefault();
            window.location.href = this.href;
        });
        
        notificationBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            const isVisible = notificationPanel.style.display === 'block';
            
            if (isVisible) {
                notificationPanel.style.animation = 'slideOut 0.3s';
                setTimeout(() => {
                    notificationPanel.style.display = 'none';
                }, 300);
            } else {
                notificationPanel.style.display = 'block';
                notificationPanel.style.animation = 'slideIn 0.3s';
            }
        });
        
        clearNotificationsBtn.addEventListener('click', function() {
            notificationList.innerHTML = '<div class="notification-item"><div class="notification-message">No notifications</div></div>';
            notificationBtn.querySelector('.notification-badge').textContent = '0';
            notificationBtn.querySelector('.notification-badge').style.display = 'none';
            
            setTimeout(() => {
                notificationPanel.style.animation = 'slideOut 0.3s';
                setTimeout(() => {
                    notificationPanel.style.display = 'none';
                }, 300);
            }, 500);
        });
        
        // Close notification panel when clicking outside
        document.addEventListener('click', function(e) {
            if (!notificationPanel.contains(e.target) && !notificationBtn.contains(e.target)) {
                notificationPanel.style.animation = 'slideOut 0.3s';
                setTimeout(() => {
                    notificationPanel.style.display = 'none';
                }, 300);
            }
        });
        
        // Auto-hide nav on scroll down, show on scroll up
        let lastScrollTop = 0;
        const nav = document.querySelector('.global-navigation');
        
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                // Scroll down
                nav.style.transform = 'translateY(-100%)';
                nav.style.transition = 'transform 0.3s';
            } else {
                // Scroll up
                nav.style.transform = 'translateY(0)';
            }
            
            lastScrollTop = scrollTop;
        });
        
        // Mark notification as read when clicked
        document.addEventListener('DOMContentLoaded', function() {
            const notificationItems = document.querySelectorAll('.notification-item');
            
            notificationItems.forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.remove('unread');
                    
                    // Update notification badge count
                    const unreadCount = document.querySelectorAll('.notification-item.unread').length;
                    const badge = notificationBtn.querySelector('.notification-badge');
                    
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                });
            });
            
            // Highlight active navigation item based on current page
            const currentPage = window.location.pathname.split('/').pop();
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                const href = item.getAttribute('href');
                if (href === currentPage || (currentPage === '' && href === 'index.html')) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        });

        // Dữ liệu mẫu cho funnel
        const funnelData = {
            all: {
                steps: [
                    { name: "Impressions", value: 245200, conversion: "+12% WoW" },
                    { name: "Landing Page", value: 45800, conversion: "18.7% CTR" },
                    { name: "Wallet Connect", value: 12400, conversion: "27.1% Rate" },
                    { name: "First TX", value: 3200, conversion: "25.8% Rate" },
                    { name: "Activated Wallet", value: 1800, conversion: "56.3% Rate" }
                ],
                dropoff: [81.3, 72.9, 74.2, 43.7]
            },
            players: {
                steps: [
                    { name: "Impressions", value: 142000, conversion: "+15% WoW" },
                    { name: "Landing Page", value: 31200, conversion: "22.0% CTR" },
                    { name: "Wallet Connect", value: 9400, conversion: "30.1% Rate" },
                    { name: "First TX", value: 2800, conversion: "29.8% Rate" },
                    { name: "Activated Wallet", value: 1680, conversion: "60.0% Rate" }
                ],
                dropoff: [78.0, 69.9, 70.2, 40.0]
            },
            traders: {
                steps: [
                    { name: "Impressions", value: 48000, conversion: "+5% WoW" },
                    { name: "Landing Page", value: 6200, conversion: "12.9% CTR" },
                    { name: "Wallet Connect", value: 1300, conversion: "21.0% Rate" },
                    { name: "First TX", value: 210, conversion: "16.2% Rate" },
                    { name: "Activated Wallet", value: 80, conversion: "38.1% Rate" }
                ],
                dropoff: [87.1, 79.0, 83.8, 61.9]
            },
            collectors: {
                steps: [
                    { name: "Impressions", value: 32000, conversion: "+8% WoW" },
                    { name: "Landing Page", value: 4800, conversion: "15.0% CTR" },
                    { name: "Wallet Connect", value: 1200, conversion: "25.0% Rate" },
                    { name: "First TX", value: 450, conversion: "37.5% Rate" },
                    { name: "Activated Wallet", value: 280, conversion: "62.2% Rate" }
                ],
                dropoff: [85.0, 75.0, 62.5, 37.8]
            }
        };

        // Dữ liệu heatmap
        const heatmapData = {
            sources: ['Twitch', 'Twitter', 'OpenSea', 'Discord', 'YouTube'],
            steps: ['Impressions → Landing', 'Landing → Connect', 'Connect → First TX', 'First TX → Activated'],
            data: {
                Twitch: [60, 25, 18, 12],
                Twitter: [45, 12, 8, 5],
                OpenSea: [70, 40, 30, 22],
                Discord: [55, 35, 28, 18],
                YouTube: [50, 20, 15, 9]
            },
            changes: {
                Twitch: ['+5%', '+3%', '-2%', '+4%'],
                Twitter: ['-8%', '-5%', '+1%', '-2%'],
                OpenSea: ['+12%', '+8%', '+5%', '+6%'],
                Discord: ['+3%', '+6%', '+4%', '+5%'],
                YouTube: ['-2%', '-3%', '-1%', '-4%']
            }
        };

        let currentSegment = 'all';
        let segmentChart;
        let heatmapView = 'conversion'; // 'conversion' or 'dropoff'

        // Khởi tạo dashboard
        function initDashboard() {
            updateFunnelSteps();
            createHeatmap();
            initSegmentChart();
            updateDate();
            startLiveCounter();
        }

        // Cập nhật funnel steps
        function updateFunnelSteps() {
            const data = funnelData[currentSegment];
            
            data.steps.forEach((step, index) => {
                const stepNumber = index + 1;
                const valueElement = document.getElementById(`step-${stepNumber}-value`);
                
                if (valueElement) {
                    if (stepNumber === 1) {
                        valueElement.textContent = `${(step.value / 1000).toFixed(1)}K`;
                    } else {
                        valueElement.textContent = `${(step.value / 1000).toFixed(1)}K`;
                    }
                }
                
                // Cập nhật conversion text
                const conversionElement = document.querySelector(`.step-${stepNumber} .step-conversion span`);
                if (conversionElement && stepNumber > 1) {
                    if (stepNumber === 2) {
                        conversionElement.textContent = step.conversion;
                    } else {
                        const conversionText = step.conversion.includes('+') ? 
                            `<i class="fas fa-arrow-up conversion-up"></i><span class="conversion-up">${step.conversion}</span>` :
                            `<span>${step.conversion}</span>`;
                        document.querySelector(`.step-${stepNumber} .step-conversion`).innerHTML = conversionText;
                    }
                }
            });
        }

        // Tạo heatmap
        function createHeatmap() {
            const heatmap = document.getElementById('heatmap');
            heatmap.innerHTML = '';
            
            // Tạo header row
            const headerRow = document.createElement('div');
            headerRow.className = 'heatmap-row';
            
            // Empty cell ở góc
            const emptyCell = document.createElement('div');
            emptyCell.className = 'heatmap-cell heatmap-header';
            emptyCell.textContent = 'Traffic Source';
            headerRow.appendChild(emptyCell);
            
            // Các step headers
            heatmapData.steps.forEach(step => {
                const stepCell = document.createElement('div');
                stepCell.className = 'heatmap-cell heatmap-header';
                stepCell.textContent = step;
                headerRow.appendChild(stepCell);
            });
            
            heatmap.appendChild(headerRow);
            
            // Tạo data rows
            heatmapData.sources.forEach(source => {
                const row = document.createElement('div');
                row.className = 'heatmap-row';
                
                // Source cell
                const sourceCell = document.createElement('div');
                sourceCell.className = 'heatmap-cell heatmap-header heatmap-source';
                sourceCell.innerHTML = `
                    <div class="source-icon ${source.toLowerCase()}-icon">
                        <i class="fab fa-${source.toLowerCase()}"></i>
                    </div>
                    ${source}
                `;
                row.appendChild(sourceCell);
                
                // Data cells
                heatmapData.data[source].forEach((value, index) => {
                    const dataCell = document.createElement('div');
                    dataCell.className = 'heatmap-cell';
                    dataCell.style.backgroundColor = getHeatmapColor(value);
                    dataCell.onclick = () => showHeatmapDetail(source, heatmapData.steps[index], value);
                    
                    const changeValue = heatmapData.changes[source][index];
                    const isPositive = changeValue.includes('+');
                    
                    dataCell.innerHTML = `
                        <div class="heatmap-value">${value}%</div>
                        <div class="heatmap-change" style="color: ${isPositive ? 'var(--accent-success)' : 'var(--accent-danger)'}">
                            ${isPositive ? '<i class="fas fa-arrow-up"></i>' : '<i class="fas fa-arrow-down"></i>'}
                            ${changeValue}
                        </div>
                    `;
                    
                    row.appendChild(dataCell);
                });
                
                heatmap.appendChild(row);
            });
        }

        // Lấy màu cho heatmap
        function getHeatmapColor(value) {
            if (value >= 60) return 'rgba(0, 255, 136, 0.3)';
            if (value >= 40) return 'rgba(255, 170, 0, 0.3)';
            if (value >= 20) return 'rgba(255, 68, 102, 0.3)';
            return 'rgba(106, 61, 201, 0.3)';
        }

        // Khởi tạo biểu đồ segment
        function initSegmentChart() {
            const ctx = document.getElementById('segmentChart').getContext('2d');
            
            const segments = ['Players', 'Traders', 'Collectors'];
            const steps = ['Impressions', 'Landing Page', 'Wallet Connect', 'First TX', 'Activated Wallet'];
            
            segmentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: steps,
                    datasets: [
                        {
                            label: 'Players',
                            data: [100, 22, 6.6, 2.0, 1.2],
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Traders',
                            data: [100, 12.9, 2.7, 0.44, 0.17],
                            borderColor: '#8a2be2',
                            backgroundColor: 'rgba(138, 43, 226, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Collectors',
                            data: [100, 15.0, 3.75, 1.41, 0.88],
                            borderColor: '#ffaa00',
                            backgroundColor: 'rgba(255, 170, 0, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#a0a0c0',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 26, 46, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#8a2be2',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#a0a0c0',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Conversion Rate (%)',
                                color: '#a0a0c0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#a0a0c0'
                            }
                        }
                    }
                }
            });
        }

        // Thay đổi segment
        function changeSegment(segment) {
            // Cập nhật nút active
            document.querySelectorAll('.segment-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentSegment = segment;
            updateFunnelSteps();
            showAlert(`Đang xem funnel cho segment: ${segment === 'all' ? 'All Users' : segment}`);
        }

        // Toggle heatmap view
        function toggleHeatmapView() {
            heatmapView = heatmapView === 'conversion' ? 'dropoff' : 'conversion';
            
            if (heatmapView === 'dropoff') {
                // Chuyển sang drop-off view
                heatmapData.steps = ['Impressions → Landing', 'Landing → Connect', 'Connect → First TX', 'First TX → Activated'];
                heatmapData.data = {
                    Twitch: [40, 75, 82, 88],
                    Twitter: [55, 88, 92, 95],
                    OpenSea: [30, 60, 70, 78],
                    Discord: [45, 65, 72, 82],
                    YouTube: [50, 80, 85, 91]
                };
            } else {
                // Chuyển về conversion view
                heatmapData.steps = ['Impressions → Landing', 'Landing → Connect', 'Connect → First TX', 'First TX → Activated'];
                heatmapData.data = {
                    Twitch: [60, 25, 18, 12],
                    Twitter: [45, 12, 8, 5],
                    OpenSea: [70, 40, 30, 22],
                    Discord: [55, 35, 28, 18],
                    YouTube: [50, 20, 15, 9]
                };
            }
            
            createHeatmap();
            showAlert(`Đã chuyển sang ${heatmapView === 'conversion' ? 'Conversion Rate' : 'Drop-off Rate'} view`);
        }

        // Toggle segment chart
        function toggleSegmentChart() {
            if (segmentChart) {
                const isVisible = segmentChart.data.datasets[0].hidden;
                
                segmentChart.data.datasets.forEach(dataset => {
                    dataset.hidden = !isVisible;
                });
                
                segmentChart.update();
                showAlert(`${isVisible ? 'Hiển thị' : 'Ẩn'} segment data trên biểu đồ`);
            }
        }

        // Hiển thị step details
        function showStepDetails(stepNumber) {
            const stepNames = [
                'Impressions',
                'Landing Page Visit',
                'Wallet Connection',
                'First Transaction',
                'Wallet Activation'
            ];
            
            const stepDescriptions = [
                'Tổng số lần quảng cáo được hiển thị cho người dùng',
                'Người dùng nhấp vào quảng cáo và đến landing page',
                'Người dùng kết nối ví cryptocurrency của họ',
                'Người dùng thực hiện giao dịch đầu tiên trên nền tảng',
                'Người dùng hoàn thành onboarding và được xem là activated'
            ];
            
            const data = funnelData[currentSegment];
            const step = data.steps[stepNumber - 1];
            const dropoff = stepNumber > 1 ? data.dropoff[stepNumber - 2] : 0;
            
            alert(`Chi tiết Step ${stepNumber}: ${stepNames[stepNumber - 1]}\n\n` +
                  `• Số lượng: ${step.value.toLocaleString()}\n` +
                  `• Conversion Rate: ${step.conversion}\n` +
                  `• Drop-off Rate: ${stepNumber > 1 ? dropoff + '%' : 'N/A'}\n` +
                  `• Mô tả: ${stepDescriptions[stepNumber - 1]}\n\n` +
                  `Recommendation: ${getStepRecommendation(stepNumber)}`);
        }

        // Lấy recommendation cho từng step
        function getStepRecommendation(stepNumber) {
            const recommendations = [
                'Optimize ad targeting và creative để tăng impressions quality',
                'A/B test landing page design và messaging để tăng CTR',
                'Simplify wallet connection flow và fix technical errors',
                'Implement gas sponsorship và guided tutorial cho first transaction',
                'Improve post-activation experience để tăng retention'
            ];
            return recommendations[stepNumber - 1];
        }

        // Hiển thị heatmap detail
        function showHeatmapDetail(source, step, value) {
            const stepNames = {
                'Impressions → Landing': 'Click-through Rate',
                'Landing → Connect': 'Wallet Connection Rate',
                'Connect → First TX': 'First Transaction Rate',
                'First TX → Activated': 'Activation Rate'
            };
            
            alert(`Chi tiết Performance:\n\n` +
                  `• Nguồn: ${source}\n` +
                  `• Bước: ${step}\n` +
                  `• ${stepNames[step]}: ${value}%\n` +
                  `• Đánh giá: ${getPerformanceRating(value)}\n\n` +
                  `Recommendation: ${getSourceRecommendation(source, step, value)}`);
        }

        // Đánh giá performance
        function getPerformanceRating(value) {
            if (value >= 60) return 'Excellent 🏆';
            if (value >= 40) return 'Good 👍';
            if (value >= 20) return 'Needs Improvement ⚠️';
            return 'Poor 🚨';
        }

        // Lấy recommendation cho source
        function getSourceRecommendation(source, step, value) {
            if (value >= 60) return `Continue current strategy for ${source}`;
            if (value >= 40) return `Optimize ${step} for ${source}`;
            if (value >= 20) return `Test new approaches for ${source} at ${step}`;
            return `Consider reallocating budget from ${source}`;
        }

        // Xuất dữ liệu funnel
        function exportFunnelData() {
            alert(`Đang xuất dữ liệu funnel...\n\nFile: Funnel_Data_${currentSegment}_${getCurrentDate()}.csv`);
        }

        // Refresh data
        function refreshFunnelData() {
            showAlert('Đang refresh funnel data...');
            
            // Simulate data refresh
            setTimeout(() => {
                const liveUsers = Math.floor(Math.random() * 500) + 1500;
                document.getElementById('live-users').textContent = liveUsers.toLocaleString();
                showAlert('Funnel data đã được cập nhật');
            }, 1000);
        }

        // View all A/B tests
        function viewAllTests() {
            alert('Tất cả A/B Tests đang chạy:\n\n' +
                  '1. Landing Page Design (CTR: +8%)\n' +
                  '2. Wallet Connection Flow (Conversion: +12%)\n' +
                  '3. First TX Tutorial (Time-to-TX: -22%)\n' +
                  '4. Activation Welcome Message (D7 Retention: +15%)\n\n' +
                  'Tổng cộng: 4 tests đang chạy, 2 đã kết thúc');
        }

        // Run bottleneck analysis
        function runBottleneckAnalysis() {
            showAlert('Đang chạy bottleneck analysis...');
            
            setTimeout(() => {
                alert('Bottleneck Analysis Results:\n\n' +
                      '1. Step 2→3 (Landing → Connect): 72.9% drop-off\n' +
                      '   - Root Cause: Technical errors (32%), UX confusion (28%), Intent mismatch (40%)\n' +
                      '   - Fix: Auto-retry wallet connection, better error messages\n\n' +
                      '2. Step 3→4 (Connect → First TX): 74.2% drop-off\n' +
                      '   - Root Cause: Gas fees (45%), Complexity (35%), Security concerns (20%)\n' +
                      '   - Fix: Gas sponsorship, guided tutorial, security reassurances');
            }, 1500);
        }

        // Prioritize recommendations
        function prioritizeRecommendations() {
            showAlert('Đang ưu tiên hóa recommendations...\n\n' +
                      '1. Fix Wallet Connection (ROI: 3.2x)\n' +
                      '2. Simplify First TX (ROI: 2.8x)\n' +
                      '3. Improve Value Proposition (ROI: 1.8x)\n' +
                      '4. A/B Test Landing Page (ROI: 1.5x)\n\n' +
                      'Ưu tiên dựa trên: Impact, Effort, ROI, User Feedback');
        }

        // Cập nhật ngày hiện tại
        function updateDate() {
            const now = new Date();
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('vi-VN', options);
        }

        // Live counter cho users trong funnel
        function startLiveCounter() {
            setInterval(() => {
                const liveUsersElement = document.getElementById('live-users');
                let currentUsers = parseInt(liveUsersElement.textContent.replace(/,/g, ''));
                const change = Math.floor(Math.random() * 21) - 10; // -10 to +10
                currentUsers = Math.max(1500, currentUsers + change);
                liveUsersElement.textContent = currentUsers.toLocaleString();
            }, 5000);
        }

        // Lấy ngày hiện tại định dạng
        function getCurrentDate() {
            const now = new Date();
            return `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
        }

        // Hiển thị alert
        function showAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background-color: var(--card-bg);
                color: var(--text-primary);
                padding: 15px 20px;
                border-radius: 10px;
                border-left: 4px solid var(--primary-web3);
                box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                z-index: 1000;
                max-width: 400px;
                animation: slideIn 0.3s;
                border: 1px solid var(--card-border);
            `;
            
            alertDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-info-circle" style="color: var(--primary-web3);"></i>
                    <div>${message}</div>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'slideOut 0.3s';
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                }, 300);
            }, 3000);
        }

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            
            // Thêm hover effects
            document.querySelectorAll('.funnel-metric, .abtest-variant, .rec-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                    this.style.boxShadow = '0 12px 40px rgba(0, 0, 0, 0.4)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
        });
    </script>
</body>
</html>
